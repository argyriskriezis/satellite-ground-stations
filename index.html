<!DOCTYPE html>
<html>
<head>
    <title>Ground Station Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 90vh; width: 100%; }
        .filter { margin: 10px; }
    </style>
</head>
<body>

<div class="filter">
    <label for="company">Company:</label>
    <select id="company">
        <option value="all">All</option>
        <option value="Atlas">Atlas</option>
        <option value="Atlas Partner">Atlas Partner</option>
        <option value="SSC">SSC</option>
    </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Initialize map
var map = L.map('map').setView([20, 0], 2);

// Add OpenStreetMap basemap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18
}).addTo(map);


// Layer to hold markers
var stationLayer = L.layerGroup().addTo(map);

var stationsData; // will hold the fetched GeoJSON

// Function to create popup content dynamically
function createPopup(properties) {
    // Basic info
    var html = `<b>Location:</b> ${properties.city || properties.station}, ${properties.country}<br>`;
    html += `<b>Company:</b> ${properties.company}<br>`;
    html += `<b>Status:</b> ${properties.status || 'Unknown'}<br>`;

    // Frequencies
    var freqs = [];
    if(properties.S_band_Tx || properties.S_band_Rx) freqs.push("S-band");
    if(properties.X_band_Rx) freqs.push("X-band");
    if(properties.Ka_band_Rx) freqs.push("Ka-band");
    if(properties.UHF_Tx || properties.UHF_Rx) freqs.push("UHF");

    if(freqs.length > 0){
        html += `<b>Frequencies:</b> ${freqs.join(', ')}`;
    }

    return html;
}


// Function to update markers
function updateMarkers(companyFilter) {
    stationLayer.clearLayers();
    stationsData.features.forEach(function(f) {
        if (companyFilter === "all" || f.properties.company === companyFilter) {
            // Create a slick circle marker
            var marker = L.circleMarker([f.geometry.coordinates[1], f.geometry.coordinates[0]], {
                radius: 8,                  // size
                fillColor: "#3388ff",       // color
                color: "#000",              // border color
                weight: 1,
                opacity: 1,
                fillOpacity: 0.9
            });

            // Bind dynamic popup
            marker.bindPopup(createPopup(f.properties));

            // Add marker to layer
            marker.addTo(stationLayer);
        }
    });
}

// Fetch stations from external file
fetch('stations.geojson')
    .then(response => response.json())
    .then(data => {
        stationsData = data;
        updateMarkers("all"); // show all markers initially
    })
    .catch(error => console.error('Error loading stations.geojson:', error));

// Event listener for filter
document.getElementById("company").addEventListener("change", function() {
    updateMarkers(this.value);
});
</script>

</body>
</html>
