<!DOCTYPE html>
<html>
<head>
    <title>Ground Station Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 90vh; width: 100%; }
        .filter { margin: 10px; }
    </style>
</head>
<body>

<div class="filter">
    <label for="company">Company:</label>
    <select id="company">
        <option value="all">All</option>
        <option value="Atlas">Atlas</option>
        <option value="Atlas Partner">Atlas Partner</option>
        <option value="SSC">SSC</option>
    </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>

// Initialize map
var map = L.map('map').setView([20, 0], 2);

// Add OpenStreetMap basemap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

// Layer to hold markers
var stationLayer = L.layerGroup().addTo(map);
var stationsData; 

// Function to create popup content dynamically
function createPopup(properties) {

    var locationName = properties.station || properties.city || "Unknown Location";
    
    var html = `<b>Location:</b> ${locationName}, ${properties.country}<br>`;
    html += `<b>Company:</b> ${properties.company}<br>`;
    html += `<b>Status:</b> <span style="color: ${properties.status === 'Operational' ? 'green' : 'red'}">${properties.status || 'Unknown'}</span><br>`;

    var freqs = [];
    if(properties.S_band_Tx === true || properties.S_band_Rx === true) freqs.push("S-band");
    if(properties.X_band_Rx === true) freqs.push("X-band");
    if(properties.Ka_band_Rx === true) freqs.push("Ka-band");
    if(properties.UHF_Tx === true || properties.UHF_Rx === true) freqs.push("UHF");

    if(freqs.length > 0){
        html += `<b>Frequencies:</b> ${freqs.join(', ')}`;
    } else {
        html += `<b>Frequencies:</b> None listed`;
    }

    return html;
}


// Function to update markers
function updateMarkers(companyFilter) {
    stationLayer.clearLayers();
    
    if (!stationsData) return;

    stationsData.features.forEach(function(f) {
        if (companyFilter === "all" || f.properties.company === companyFilter) {
            var marker = L.circleMarker([f.geometry.coordinates[1], f.geometry.coordinates[0]], {
                radius: 8,
                fillColor: "#3388ff",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.9
            });

            marker.bindPopup(createPopup(f.properties));
            marker.addTo(stationLayer);
        }
    });
}

// Fetch stations from external file
fetch('stations.geojson')
    .then(response => {
        if (!response.ok) throw new Error("HTTP error " + response.status);
        return response.json();
    })
    .then(data => {
        stationsData = data;
        updateMarkers("all");
    })
    .catch(error => {
        console.error('Error loading GeoJSON:', error);
        alert("Could not load stations.geojson. Ensure you are using a local web server.");
    });

document.getElementById("company").addEventListener("change", function() {
    updateMarkers(this.value);
});
</script>

</body>
</html>
